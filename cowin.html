<!DOCTYPE html>
<html>
   <head>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script>
         //var bookData = data;
		 // {"district_id":363,"district_name":"Pune"}
		 // {"districts":[{"district_id":391,"district_name":"Ahmednagar"},{"district_id":364,"district_name":"Akola"},{"district_id":366,"district_name":"Amravati"},{"district_id":397,"district_name":"Aurangabad "},{"district_id":384,"district_name":"Beed"},{"district_id":370,"district_name":"Bhandara"},{"district_id":367,"district_name":"Buldhana"},{"district_id":380,"district_name":"Chandrapur"},{"district_id":388,"district_name":"Dhule"},{"district_id":379,"district_name":"Gadchiroli"},{"district_id":378,"district_name":"Gondia"},{"district_id":386,"district_name":"Hingoli"},{"district_id":390,"district_name":"Jalgaon"},{"district_id":396,"district_name":"Jalna"},{"district_id":371,"district_name":"Kolhapur"},{"district_id":383,"district_name":"Latur"},{"district_id":395,"district_name":"Mumbai"},{"district_id":365,"district_name":"Nagpur"},{"district_id":382,"district_name":"Nanded"},{"district_id":387,"district_name":"Nandurbar"},{"district_id":389,"district_name":"Nashik"},{"district_id":381,"district_name":"Osmanabad"},{"district_id":394,"district_name":"Palghar"},{"district_id":385,"district_name":"Parbhani"},{"district_id":363,"district_name":"Pune"},{"district_id":393,"district_name":"Raigad"},{"district_id":372,"district_name":"Ratnagiri"},{"district_id":373,"district_name":"Sangli"},{"district_id":376,"district_name":"Satara"},{"district_id":374,"district_name":"Sindhudurg"},{"district_id":375,"district_name":"Solapur"},{"district_id":392,"district_name":"Thane"},{"district_id":377,"district_name":"Wardha"},{"district_id":369,"district_name":"Washim"},{"district_id":368,"district_name":"Yavatmal"}],"ttl":24}
		 // gorakhpur 654
         $(document).ready(function(){
         	var availPinCodeArr = [];
           var urlDist = "https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByDistrict?district_id=363&date=11-05-2021";
           var urlPinCode = "https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode=273008&date=11-05-2021";
          var waitTimeInSeconds = 10;
         var count = 0;
		 var tick = 0;
         pollDOM();
         function pollDOM () {
         
         $("#tickId").text("Time :" + new Date());
         	checkAval();
             setTimeout(pollDOM, waitTimeInSeconds* 1000); // try again in 300 milliseconds
         }
          function checkAval(){
         	 tick++;						
         	$("#countId").text("Tick : "+ tick + ",  Slot Found : " + count);
             $.get(urlDist, function(data, status){
          //     console.log(data);
         	  jQuery.each(data.centers, function(index, jsonValue){ 
         //		console.log(jsonValue.sessions);
         		jQuery.each(jsonValue.sessions , function(inde, sess){
         	//		console.log(sess.available_capacity);
         			if(sess.available_capacity > 0 && jQuery.inArray(jsonValue.pincode, availPinCodeArr) == -1){
         				count++;
         				availPinCodeArr.push(jsonValue.pincode);
         				var addrEl = $("<p></p>").text("address :" + jsonValue.address +" "+ jsonValue.pincode);
         				var dateEl = $("<p></p>").text("Date :" + sess.date);
         				var countEl = $("<p></p>").text("Available :" + sess.available_capacity + "    [age: " + sess.min_age_limit + "+]");
         				var timeEl = $("<p></p>").text("Slot Open Time :" + new Date());
         				var seperEl = $("<hr >");
         				$("#avalDivId").append(addrEl, dateEl, countEl, timeEl, seperEl);		
         			}
         		});
         	  });
          //      $("#target").text(  JSON.stringify(data));
         	  //   alert("Data: " + JSON.stringify(data) + "\nStatus: " + status);
             });
           }
         });
      </script>
   </head>
   <body>
      <h4 id="countId">
      </h2>
      <h4 id="tickId"></h4>
      <br/>
      <div id = "avalDivId">
         <br/>
      </div>
      <br/>
      <br/>
      <div id="target"></div>
   </body>
</html>
<!-- 
   {
   	"centers": [
   		{
   			"center_id": 692559,
   			"name": "AIIMS AYOUSH 18 TO 44 YEAR",
   			"address": "AIIMS AYOUSH BUILDING GORAKHPUR",
   			"state_name": "Uttar Pradesh",
   			"district_name": "Gorakhpur",
   			"block_name": "Gorakhpur Sadar",
   			"pincode": 273008,
   			"lat": 26,
   			"long": 83,
   			"from": "10:00:00",
   			"to": "16:00:00",
   			"fee_type": "Free",
   			"sessions": [
   				{
   					"session_id": "dbd0a069-ba59-4f67-a457-f14ef8384fe7",
   					"date": "11-05-2021",
   					"available_capacity": 0,
   					"min_age_limit": 18,
   					"vaccine": "COVISHIELD",
   					"slots": [
   						"10:00AM-11:00AM",
   						"11:00AM-12:00PM",
   						"12:00PM-01:00PM",
   						"01:00PM-04:00PM"
   					]
   				},
   				{
   					"session_id": "32750ad2-db28-41e1-895d-fc46f4c09201",
   					"date": "12-05-2021",
   					"available_capacity": 0,
   					"min_age_limit": 18,
   					"vaccine": "COVISHIELD",
   					"slots": [
   						"10:00AM-11:00AM",
   						"11:00AM-12:00PM",
   						"12:00PM-01:00PM",
   						"01:00PM-04:00PM"
   					]
   				},
   				{
   					"session_id": "b6e5f43b-70fe-42aa-9c93-025f960db318",
   					"date": "13-05-2021",
   					"available_capacity": 0,
   					"min_age_limit": 18,
   					"vaccine": "COVISHIELD",
   					"slots": [
   						"10:00AM-11:00AM",
   						"11:00AM-12:00PM",
   						"12:00PM-01:00PM",
   						"01:00PM-04:00PM"
   					]
   				},
   				{
   					"session_id": "d8223143-dc0b-4ea0-9b6f-84795dcf1248",
   					"date": "14-05-2021",
   					"available_capacity": 0,
   					"min_age_limit": 18,
   					"vaccine": "COVISHIELD",
   					"slots": [
   						"10:00AM-11:00AM",
   						"11:00AM-12:00PM",
   						"12:00PM-01:00PM",
   						"01:00PM-04:00PM"
   					]
   				},
   				{
   					"session_id": "dc3bb0b5-377b-4019-97fb-cd27843a6bbe",
   					"date": "15-05-2021",
   					"available_capacity": 0,
   					"min_age_limit": 18,
   					"vaccine": "COVISHIELD",
   					"slots": [
   						"10:00AM-11:00AM",
   						"11:00AM-12:00PM",
   						"12:00PM-01:00PM",
   						"01:00PM-04:00PM"
   					]
   				}
   			]
   		}
   	]
   }
   -->